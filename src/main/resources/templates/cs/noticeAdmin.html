<div class="card">
    <h5 class="card-header">Notice List</h5>
    <div class="table-responsive text-nowrap">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>번호</th>
                <th>제목</th>
                <th>조회수</th>
                <th>등록일자</th>
            </tr>
            </thead>
            <tbody class="table-border-bottom-0">
            <tr th:each="notice : ${noticeList}">
                <td th:text="${notice.pinned ? '!' : notice.id}"></td>
                <td><i class="fab fa-angular fa-lg text-danger me-3"></i>
                    <a href="javascript:void(0);" class="menu-link notice_btn"
                       th:text="${notice.title}" th:data-id="${notice.id}" th:data-page="${currentPage}"></a>
                </td>
                <td th:text="${notice.viewCount}"></td>
                <td th:text="${notice.regDate}"></td>


                <td>
                    <div class="dropdown">
                        <button class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown" type="button">
                            <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="javascript:void(0);"
                            ><i class="bx bx-edit-alt me-1"></i> Edit</a
                            >
                            <a class="dropdown-item" href="javascript:void(0);"
                            ><i class="bx bx-trash me-1"></i> Delete</a
                            >
                        </div>
                    </div>
                </td>
            </tr>


            </tbody>
        </table>

        <div class="paging_btn">
            <div id="pagination"></div>
        </div>

<!--        <div>-->
<!--            <a href="javascript:void(0);" class="add-notice" >작성</a>-->
<!--        </div>-->

    </div>
</div>

<script th:inline="javascript">
    $(document).ready(function() {
        // // 작성
        // $('.add-notice').on('click', function() {
        //     $('.container-xxl').load(`/admin/notice/add`);
        // });

        // 공지사항 상세페이지
        $('.notice_btn').on('click', function() {
            const noticeId = this.getAttribute('data-id');
            const currentPage = this.getAttribute('data-page'); // 현재 페이지 값 가져오기

            console.log("현재 게시물의 이전 페이지 값 ", currentPage);

            // AJAX 요청을 통해 페이지를 불러옴
            $.ajax({
                type: "GET",
                url: `/admin/notice/${noticeId}`, // URL에는 id만 포함
                data: { currentPage: currentPage }, // 추가 매개변수로 currentPage 값 전달
                success: function(response) {
                    $('.container-xxl').html(response); // 성공 시 페이지 콘텐츠를 업데이트
                },
                error: function(xhr, status, error) {
                }
            });
        });

        // 파람으로 코드 압축. 계속 참고.
        // data-date 기억할 것. | data-term="a"   $(el).data("term")에는 a가 들어가 있음
        function generateTag (param1, param2) {
            // 두 코드의 차이는 구문
            return `<a class="page-item" href="javascript:void(0);" onclick="parentMovePage(${param1});"  >${param2}&nbsp;</a>`; // 텝플릿 리터럴 이라는 표기법
            // return '<a class="page-item" href="javascript:void(0);" onclick="parentMovePage('+param1+');"  >'+param2+'</a>'; // 일반적인 문자열 구문
        }

        function generatePaginationButtons(totalPages) {
            let paginationHTML = '';
            paginationHTML +=  generateTag(1, '처음')
            paginationHTML +=  generateTag([[${currentPage} - 1]], '이전')

            for(let i = 1; i <= totalPages; i++) {
                paginationHTML += generateTag(i, i)
                // paginationHTML += `<a class="page-item" href="javascript:void(0);" onclick="parentMovePage(${i});">${i}&nbsp;</a>`;
            }

            paginationHTML += generateTag([[${currentPage} + 1]], '다음');
            paginationHTML += generateTag([[${totalPages}]], '끝');

            $("#pagination").html(paginationHTML);
        }
        generatePaginationButtons([[${totalPages}]]);
    });

    function parentMovePage(page) {
        if(page < 1 || page > [[${totalPages}]]) {
            return;
        }

        goPage(page, 10);
    }

</script>