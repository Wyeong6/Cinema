<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en"
      layout:decorate="~{layout/layout_total}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Cinemacast</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
    <link href="/assets/css/main.css" rel="stylesheet"/>
    <link href="/assets/css/custom.css" rel="stylesheet"/>
    <link href="/assets/css/nav.css" rel="stylesheet"/>
    <noscript>
        <link href="/assets/css/noscript.css" rel="stylesheet"/>
    </noscript>
</head>
<body class="no-sidebar is-preload">
<th:block layout:fragment="content">
    <div id="page-wrapper">
        <!-- Main -->
        <div class="wrapper style1 list">
            <div class="container">
                <div class="cart_list">
                    <article class="special" id="main">
                        <header>
                            <h2><a href="#">장바구니</a></h2>
                            <p><b id="product_list_count">0</b>개 담겨있습니다.</p>
                        </header>
                        <section id="cart_list_section">
                            <div class="row">
                                <table class="default" id="cartTable">
                                    <tr>
                                        <th>상품</th>
                                        <th></th>
                                        <th>갯수</th>
                                        <th>합계</th>
                                        <th></th>
                                    </tr>
                                </table>
                            </div>
                            <div class="button_box">
                                <button class="button continue_btn" onclick="location.href='/snack/snackList'">쇼핑 계속하기
                                </button>
                                <div class="price_box">
                                    <h4 style="font-weight: bold">Total Price</h4>
                                    <p id="total_price2">250,000원</p>
                                </div>
                            </div>
                        </section>
                    </article>
                    <article class="special" id="pay">
                        <header>
                            <h2>Payment Info.</h2>
                        </header>
                        <section id="payment_section">
                            <div class="row">
                                <div id="payment">
                                    <p>Payment Method:</p>
                                    <button class="button">Credit Card</button>
                                </div>
                            </div>
                        </section>
                        <button class="button">결제하기</button>
                    </article>
                </div>
                <hr/>
                <div class="recommend">
                    <h3 style="font-size: 40px; margin-bottom: 1em">추천 상품</h3>
                    <div class="row">
                        <article class="col-2 col-12-mobile special">
                            <a class="image featured" href="#"><img alt="" src="/images/pic07.jpg"/></a>
                            <header>
                                <h3><a href="#">Gravida aliquam penatibus</a></h3>
                            </header>
                        </article>
                        <!--                                                <article class="col-2 col-12-mobile special">-->
                        <!--                                                    <a class="image featured" href="#"><img alt="" src="images/pic08.jpg"/></a>-->
                        <!--                                                    <header>-->
                        <!--                                                        <h3><a href="#">Sed quis rhoncus placerat</a></h3>-->
                        <!--                                                    </header>-->
                        <!--                                                </article>-->
                        <!--                                                <article class="col-2 col-12-mobile special">-->
                        <!--                                                    <a class="image featured" href="#"><img alt="" src="images/pic09.jpg"/></a>-->
                        <!--                                                    <header>-->
                        <!--                                                        <h3><a href="#">Magna laoreet et aliquam</a></h3>-->
                        <!--                                                    </header>-->
                        <!--                                                </article>-->
                        <!--                                                <article class="col-2 col-12-mobile special">-->
                        <!--                                                    <a class="image featured" href="#"><img alt="" src="images/pic09.jpg"/></a>-->
                        <!--                                                    <header>-->
                        <!--                                                        <h3><a href="#">Magna laoreet et aliquam</a></h3>-->
                        <!--                                                    </header>-->
                        <!--                                                </article>-->
                        <!--                                                <article class="col-2 col-12-mobile special">-->
                        <!--                                                    <a class="image featured" href="#"><img alt="" src="images/pic09.jpg"/></a>-->
                        <!--                                                    <header>-->
                        <!--                                                        <h3><a href="#">Magna laoreet et aliquam</a></h3>-->
                        <!--                                                    </header>-->
                        <!--                                                </article>-->
                        <!--                                                <article class="col-2 col-12-mobile special">-->
                        <!--                                                    <a class="image featured" href="#"><img alt="" src="images/pic09.jpg"/></a>-->
                        <!--                                                    <header>-->
                        <!--                                                        <h3><a href="#">Magna laoreet et aliquam</a></h3>-->
                        <!--                                                    </header>-->
                        <!--                                                </article>-->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.dropotron.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/jquery.scrollex.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            //localstorage에 저장된 snackCart 장바구니 개수
            function getCartItemCount() {
                let cartItemCount = 0;
                for(let i = 0; i < localStorage.length; i++) {
                    let key = localStorage.key(i);
                    if(key.startsWith("snackCart")) {
                        cartItemCount++;
                    }
                }
                return cartItemCount;
            }

            let cartItemCount = getCartItemCount();
            document.getElementById("product_list_count").textContent = cartItemCount;

            // cart table값 가져오기
            let cartTable = document.getElementById("cartTable");
            // let totalPrice2 = 0;
            for(let i = 0; i < localStorage.length; i++) {
                let key = localStorage.key(i);
                if(key.startsWith("snackCart")) {
                    let item = JSON.parse(localStorage.getItem(key));
                    console.log("Loading item:", item);
                    // data가 배열이라면 각 요소를 확인
                    item.forEach(item => {
                        let row = cartTable.insertRow();

                        let imgCell = row.insertCell(0);
                        let nameCell = row.insertCell(1);
                        let countCell = row.insertCell(2);
                        let priceCell = row.insertCell(3);
                        let deleteCell = row.insertCell(4);

                        imgCell.innerHTML = `<img alt="${item.alt}" src="/images/menu/${item.image}">`;
                        nameCell.innerHTML = `<a href="/snack/detail?id=${item.id}">${item.name}</a>`;
                        countCell.innerHTML = `
                                    <div class="count_box">
                                        <button id="discount">-</button>
                                        <p id="countValue">${item.count}</p>
                                        <button id="upcount">+</button>
                                    </div>`;
                        priceCell.innerHTML = `
                            <p class="calc_price">${item.count} * ${item.price}</p>
                            <p class="total_price">${(item.count * item.price)}원</p>
                        `;
                        deleteCell.innerHTML = `<img alt="상품 삭제 버튼" src="/images/delete.png" onclick="removeItem('${key}')"/>`;

                        // totalPrice2 += item.count * item.price; // 진짜 최종 totalPrice2
                    });
                }
            }

            // 주문 수량 count + 합계
            const countElement = document.getElementById("countValue");
            const discountButton = document.getElementById("discount");
            const upcountButton = document.getElementById("upcount");
            const totalPriceElement = document.getElementById("total_price");
            const totalPrice2Element = document.getElementById("total_price2");

            let count = parseInt(countElement.textContent);

            function updateTotalPrice() {
                // 모든 total_price 클래스를 가진 요소를 선택
                const totalPrices = document.querySelectorAll('.total_price');
                // 총합을 저장할 변수를 초기화
                let totalPrice2 = 0;
                // 각 요소에서 값을 추출하고 총합에 더합니다.
                totalPrices.forEach(element => {
                    // 요소의 텍스트 내용을 가져와 숫자로 변환합니다.
                    const price = parseInt(element.textContent.replace('원', '').replace(/[^0-9]/g, ''));
                    // 총합에 더합니다.
                    totalPrice2 += price;
                });
                totalPrice2Element.textContent = totalPrice2.toLocaleString() + '원';
            }

            discountButton.addEventListener("click", function() {
                if(count > 1) {
                    count--;
                    countElement.textContent = count;
                    updateTotalPrice();
                }
            });

            upcountButton.addEventListener("click", function() {
                count++;
                countElement.textContent = count;
                updateTotalPrice();
            });

            // 초기 총 합계 설정
            updateTotalPrice();
        });

        function removeItem(key) {
            localStorage.removeItem(key);
            location.reload(); // 페이지를 새로고침하여 테이블을 업데이트
        }
    </script>

    <script th:inline="javascript">

    </script>
</th:block>
</body>
</html>