<!DOCTYPE html>
<html lang="en" layout:decorate="~{layout/layout_movie_get}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<body class="right-sidebar is-preload">
<th:block layout:fragment="content">
    <div id="page-wrapper">
        <div class="wrapper style1 movie_get">
            <div class="container" th:each="movie, iterStat : ${movieInfos}">
                <input type="hidden" id="movieId" th:value="${movie.id}">
                <div class="row">
                    <div class="col-12-mobile" id="content">
                        <article id="main">
                            <div class="movie_info_background">
                                <header id="get_info">
                                    <a href="#" class="image featured" onclick="toggleOverlay(this)">
                                        <img th:if="${#strings.length(movie.id) == 10}"
                                             th:src="@{|/${movie.posterPath}|}"
                                             class="featured-img"
                                             alt="ÏòÅÌôîÌè¨Ïä§ÌÑ∞"
                                        />
                                        <img th:if="${movie.posterPath != 'null' && movie.posterPath != '' && #strings.length(movie.id) != 10}"
                                             class="featured-img"
                                             th:src="@{'https://image.tmdb.org/t/p/w500' + ${movie.posterPath}}"
                                             alt="ÏòÅÌôîÌè¨Ïä§ÌÑ∞"
                                        />
                                        <img th:if="${movie.posterPath == null || movie.posterPath == '' || movie.posterPath == 'null'}"
                                             class="featured-img"
                                             th:src="@{/images/img_not_ready2.png}"
                                             alt="Ï§ÄÎπÑÏ§ë Ïù¥ÎØ∏ÏßÄ"
                                        />
                                        <div class="movie-overlay">
                                            <img th:if="${#strings.length(movie.id) == 10}"
                                                 src="/images/magnifier2.png"
                                                 onclick="openModal(this.getAttribute('src'))"
                                                 alt="ÎèãÎ≥¥Í∏∞" />
                                            <img th:if="${movie.posterPath != 'null' && movie.posterPath != '' && #strings.length(movie.id) != 10}"
                                                 src="/images/magnifier2.png"
                                                 th:onclick="'openModal(\'' + @{'https://image.tmdb.org/t/p/original' + ${movie.posterPath}} + '\')'"
                                                 alt="ÎèãÎ≥¥Í∏∞" />
                                            <img src="/images/play.png" id="videoModalBtn" th:data-video-id="${movie.video}" href="#"
                                                 class="video_btn" alt="Ìä∏Î†àÏùºÎü¨ Ïû¨ÏÉù" />
                                        </div>
                                    </a>

                                    <div class="movie_info">
                                        <span class="genres" th:text="${#strings.arrayJoin(movie.genres, ', ')}"></span>
                                        <header class="info_header">
                                            <div class="movie-title-box">
                                                <h3 th:text="${movie.title}" class="movie_title"></h3>
                                            </div>
                                            <div class="button_box">
                                                <div class="favorite-container">
                                                    <img id="favoriteButton" class="fav-icon"
                                                         src="/images/heart%20icon.png" alt="Ï∞úÌïòÍ∏∞(Ï¢ãÏïÑÏöî)">
                                                </div>
                                                <div class="btn_box">
                                                    <img onclick="shareMessage()" src="/images/share.png"
                                                         alt="Ïπ¥Ïπ¥Ïò§ÌÜ° Í≥µÏú†" id="kakao_btn" class="kakao_btn" />
                                                </div>
                                            </div>
                                        </header>

                                        <br>
                                        <div class="movie_detail">
                                            <span><b th:text="${movie.releaseDate}">releasedate</b></span>
                                            <span><b th:text="${movie.runtime} + 'Î∂Ñ'">runtime</b></span>
                                            <img id="certification-image" src="" alt="ÏòÅÌôîÏã¨ÏùòÎì±Í∏â Ïù¥ÎØ∏ÏßÄ">
                                            <span id="certification"
                                                    ><b id="certificationB" th:text="${movie.certifications}">certification</b></span>
                                            <span><b class="movie_data_averageRating"></b></span>
                                        </div>

                                        <p th:text="${movie.overview}">
                                            ~ overview ~
                                        </p>
                                        <div class="button_box">
                                            <button class="reservation_btn"><a th:href="@{'/reservation/screeningSchedule/' + ${movieId}}">ÏòàÎß§ÌïòÍ∏∞</a></button>
                                        </div>
                                    </div>
                                </header>
                            </div>
                            <div class="cast">
                                <h4>Ï∂úÏó∞ÏßÑ</h4>
                                <div id="cast-members">
                                </div>
                            </div>
                        </article>
                    </div>
                </div>

                <section class="movie_etc">
                    <div class="etc_btn">
                        <button type="button" class="button stillcut_btn clicked">Ïä§Ìã∏Ïª∑</button>
                        <!-- ÏàòÏ†ï Ïª®Ìéå ÌïÑÏöî -->
                        <button type="button" class="button reviews_btn"></button>
                    </div>
                </section>

                <!-- ÎπÑÎîîÏò§ Ìä∏Î†àÏùºÎü¨ Î™®Îã¨ -->
                <div id="videoModal" class="modal">
                    <div class="video-modal-content">
                        <span class="close">&times;</span>
                        <iframe id="videoFrame" width="560" height="315" src="" frameborder="0"
                                allowfullscreen></iframe>
                    </div>
                </div>

                <!-- Ïä§Ìã∏Ïª∑ for each (Î∞òÎ≥µ) -->
                <div id="still-cut" th:each="movie, iterStat : ${movieInfos}">
                    <div class="row">
                        <div th:each="stillCutPath, iterStat : ${movie.stillCutPaths}"
                             th:classappend="${iterStat.count > 6} ? 'hide still-cut' : 'still-cut'"
                             class="col-4 col-12-mobile special">
                            <article class="still-cut-article">
                                <a href="#" class="image featured">
                                    <img th:if="${#strings.length(movie.id) == 10}"
                                         th:src="@{|/${stillCutPath}|}" alt="Ïä§Ìã∏Ïª∑"
                                         onclick="openModal(this.getAttribute('src'))"
                                    />
                                    <img th:unless="${#strings.length(movie.id) == 10}"
                                         th:src="@{'https://image.tmdb.org/t/p/original/' + ${stillCutPath}}" alt="Ïä§Ìã∏Ïª∑"
                                         onclick="openModal(this.getAttribute('src'))"
                                    />
                                </a>
                            </article>
                        </div>
                    </div>
                    <p id="showMore" class="cursor"><a><img class="more_btn" src="/images/under-arrow.png" alt="ÎçîÎ≥¥Í∏∞"/></a></p>
                    <p id="showLess" class="cursor" style="display: none;"><a>Ï†ëÍ∏∞</a></p>
                </div>
                <div id="reviews" style="display: none">
                    <header>
                         <div class="reaction-container">
                                                                    <div class="reaction-item">
                                                                        <img id="likeButton" src="/images/like.png" alt="Ïû¨Î∞åÏñ¥Ïöî"
                                                                             onclick="react('LIKE')">
                                                                        <span class="count like-count">0</span>
                                                                    </div>
                                                                    <div class="reaction-item">
                                                                        <img id="dislikeButton" src="/images/dislike.png" alt="Ïû¨ÎØ∏ÏóÜÏñ¥Ïöî"
                                                                             onclick="react('DISLIKE')">
                                                                        <span class="count dislike-count">0</span>
                                                                    </div>
                                                                    <div class="reaction-item">
                                                                        <img id="sadButton" src="/images/sad.png" alt="Ïä¨ÌçºÏöî"
                                                                             onclick="react('SAD')">
                                                                        <span class="count sad-count">0</span>
                                                                    </div>
                                                                    <div class="reaction-item">
                                                                        <img id="funnyButton" src="/images/funny.png" alt="ÏõÉÍ≤®Ïöî"
                                                                             onclick="react('FUNNY')">
                                                                        <span class="count funny-count">0</span>
                                                                    </div>
                                                                    <div class="reaction-item">
                                                                        <img id="scaryButton" src="/images/scary.png" alt="Î¨¥ÏÑúÏõåÏöî"
                                                                             onclick="react('SCARY')">
                                                                        <span class="count scary-count">0</span>
                                                                    </div>
                                                                </div>
                        <button onclick="openReviewModal()" class="modal_open">Í¥ÄÎûåÌèâ ÏûëÏÑ±ÌïòÍ∏∞</button>
                    </header>
                    <div class="row">
                        <table class="default" id="reviews-table">
                            <!-- ÎåìÍ∏ÄÏù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê† Í≤ÉÏûÖÎãàÎã§ -->
                        </table>
                    </div>
                    <p id="showMore_review" class="cursor"><a><img class="more_btn" src="/images/under-arrow.png" alt="ÎçîÎ≥¥Í∏∞"/></a></p>
                    <p id="showLess_review" class="cursor" style="display: none;"><a>Ï†ëÍ∏∞</a></p>
                </div>
                <!-- Ïù¥ÎØ∏ÏßÄ ÏÉÅÏÑ∏Î≥¥Í∏∞ Î™®Îã¨ -->
                <div id="myModal" class="modal">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <img class="modal-content" id="modalImage">
                </div>
                <!-- ÏïàÏùΩÏùÄ Î©îÏÑ∏ÏßÄ ÌëúÏãú -->
                <div class="fixed-bottom-right" id="unreadMessages" onclick="redirectToChatRoom()">
                    <img src="/images/funny.png" alt="Unread Messages"> <!-- Ïïà ÏùΩÏùÄ Î©îÏÑ∏ÏßÄ ÏïÑÏù¥ÏΩò Ïù¥ÎØ∏ÏßÄ Í≤ΩÎ°úÏóê ÎßûÍ≤å ÏàòÏ†ï -->
                     <!-- Ïïà ÏùΩÏùÄ Î©îÏãúÏßÄ ÏàòÎ•º ÌëúÏãúÌï† ÏöîÏÜå -->
                    <span id="unreadCount">0</span>
                </div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>

    <!--              ÎåìÍ∏Ä         ------------------             -->

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var featuredImages = document.querySelectorAll('.image.featured');

            featuredImages.forEach(function(image) {
                image.addEventListener('mouseenter', function() {
                    toggleOverlay(this, true);
                });

                image.addEventListener('mouseleave', function() {
                    toggleOverlay(this, false);
                });
            });

            function toggleOverlay(element, show) {
                var overlay = element.querySelector('.movie-overlay');
                if (show) {
                    overlay.style.display = 'block';
                    overlay.style.display = 'flex';
                    overlay.style.flexDirection = 'row';
                    overlay.style.justifyContent = 'center';
                    overlay.style.alignItems = 'center';
                } else {
                    overlay.style.display = 'none';
                }
            }
        });

        const movieId = $('#movieId').val();

        // credits api Ï†úÏûëÏßÑ ÏÇ¨ÏßÑ
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI3N2UzMWU5NWVjZmE3ZjBlODY5YTE3NmQwMjU0YWQwMiIsInN1YiI6IjY2NDJiMWM1ZTJlZjM4N2Y1MjM1OTNjZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.hBVsW7eVrC2M3FdWc2OJEAWq0h4v-NiiM2YEDQoy7OU'
            }
        };

        async function fetchMovieCredits(movieId) {

            if(movieId.length === 10) {
                return;
            }

            try {
                const apiKey = '547e2cd4d0e26e68fb907dafef4f90ac';
                const url = `https://api.themoviedb.org/3/movie/${movieId}/credits?language=ko-KR&api_key=${apiKey}`;
                const response = await fetch(url);
                const data = await response.json();

                // ÏòÅÌôî Ï†ïÎ≥¥Î•º Îã¥ÏùÑ ÏöîÏÜå ÏÉùÏÑ±
                const castMembersDiv = document.getElementById('cast-members');
                castMembersDiv.style.display = 'flex'; // Flexbox Î†àÏù¥ÏïÑÏõÉ Ï†ÅÏö©
                castMembersDiv.style.flexWrap = 'wrap'; // ÏöîÏÜåÎì§Ïù¥ ÎÑòÏπòÎ©¥ Îã§Ïùå Ï§ÑÎ°ú ÎÑòÍπÄ

                // ÏòÅÌôî Í¥ÄÎûå Îì±Í∏â
                const certificationElement = document.getElementById('certification');
                const certificationBElement = document.getElementById('certificationB');
                const certificationValue = certificationElement.textContent;
                const imgElement = document.getElementById('certification-image');

                switch (certificationValue) {
                    case '12ÏÑ∏ Ïù¥ÏÉÅ Í¥ÄÎûåÍ∞Ä':
                        imgElement.src = '/images/ratings/12.png';
                        certificationBElement.style.color = '#EFC53C';
                        break;
                    case '15ÏÑ∏ Ïù¥ÏÉÅ Í¥ÄÎûåÍ∞Ä':
                        imgElement.src = '/images/ratings/15.png';
                        certificationBElement.style.color = '#D98E04';
                        break;
                    case '18ÏÑ∏ Ïù¥ÏÉÅ Í¥ÄÎûåÍ∞Ä':
                        imgElement.src = '/images/ratings/18.png';
                        certificationBElement.style.color = '#FF0000';
                        break;
                    case '19':
                        certificationElement.textContent = 'Ï≤≠ÏÜåÎÖÑ Í¥ÄÎûåÎ∂àÍ∞Ä';
                        imgElement.src = '/images/ratings/18.png';
                        certificationBElement.style.color = '#FF0000';
                        break;
                    default:
                        imgElement.src = '/images/ratings/all.svg';
                        certificationBElement.style.color = '#237042';
                }

                // Í∞êÎèÖ Ï†ïÎ≥¥ Ï∂úÎ†• (Ïù¥ÎØ∏ÏßÄ Ìè¨Ìï®)
                const director = data.crew.find(person => person.job === 'Director');
                if (director) {
                    const directorDiv = createPersonDiv(director.name, director.profile_path, true);
                    castMembersDiv.appendChild(directorDiv); // directorDivÎ•º movieInfoDivÏóê Ï∂îÍ∞Ä
                }

                // Ï∂úÏó∞ÏßÑ Ï†ïÎ≥¥ Ï∂úÎ†• (Ïù¥ÎØ∏ÏßÄ Ìè¨Ìï®)
                data.cast.slice(0, 5).forEach(cast => {
                    const castDiv = createPersonDiv(cast.name, cast.profile_path);
                    castMembersDiv.appendChild(castDiv); // castDivÎ•º movieInfoDivÏóê Ï∂îÍ∞Ä
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        fetchMovieCredits(movieId);

        // Ïù∏Î¨º Ï†ïÎ≥¥ÏôÄ Ïù¥ÎØ∏ÏßÄÎ•º Îã¥ÏùÄ div ÏÉùÏÑ± Ìï®Ïàò
        function createPersonDiv(name, profilePath, isDirector = false) {
            const personDiv = document.createElement('div'); // ÏÉàÎ°úÏö¥ div ÏÉùÏÑ±
            personDiv.style.marginRight = '13px'; // Í∞ÑÍ≤© ÏÑ§Ï†ï
            personDiv.style.width = '7em';
            personDiv.style.height = 'auto';

            const p = document.createElement('p');
            p.innerHTML = isDirector ? `<p>Í∞êÎèÖ : ${name}</p>` : `<p>${name}</p>`;
            p.style.fontSize = '0.8em'; // Í∏ÄÏûê ÌÅ¨Í∏∞ ÏûëÍ≤å ÏÑ§Ï†ï
            p.style.textAlign = 'center';

            const img = document.createElement('img');
            img.src = profilePath ? `https://image.tmdb.org/t/p/w200${profilePath}` : '/images/img_not_ready2.png';
            img.alt = `${name}'s profile image`;
            img.setAttribute('style', 'width: 100%; height: auto; border-radius: 10px;');

            personDiv.appendChild(img);
            personDiv.appendChild(p);

            return personDiv;
        }

        const api = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI3N2UzMWU5NWVjZmE3ZjBlODY5YTE3NmQwMjU0YWQwMiIsInN1YiI6IjY2NDJiMWM1ZTJlZjM4N2Y1MjM1OTNjZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.hBVsW7eVrC2M3FdWc2OJEAWq0h4v-NiiM2YEDQoy7OU'
            }
        };

        // Ïä§Ìã∏Ïª∑ ÎçîÎ≥¥Í∏∞(more), Ï†ëÍ∏∞ ÌÅ¥Î¶≠ Ìï®Ïàò
        // ÌòÑÏû¨ ÌëúÏãúÎêú Ìï≠Î™©Ïùò ÏàòÎ•º Ï∂îÏ†ÅÌïòÎäî Î≥ÄÏàò
        var visibleCount = 6; // Ï≤òÏùåÏóê Î≥¥Ïù¥Îäî Ìï≠Î™© Ïàò
        var increment = 8; // Ìïú Î≤àÏóê ÌëúÏãúÌï† Ï∂îÍ∞Ä Ìï≠Î™© Ïàò

        // Ïä§Ìã∏Ïª∑Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÎäî Ìï®Ïàò
        function hasStillCuts() {
            var stillCuts = document.querySelectorAll(".still-cut");
            return stillCuts.length > 0;
        }

        // Ï¥àÍ∏∞Ïóê "ÎçîÎ≥¥Í∏∞" Î≤ÑÌäºÏùò ÌëúÏãú Ïó¨Î∂ÄÎ•º Í≤∞Ï†ï
        if (!hasStillCuts()) {
            document.getElementById("showMore").style.display = 'none';
        } else {
            document.getElementById("showMore").style.display = 'block';
        }

        document.getElementById("showMore").addEventListener("click", function () {
            var stillCuts = document.querySelectorAll(".still-cut");
            var newVisibleCount = Math.min(visibleCount + increment, stillCuts.length);

            for (var i = visibleCount; i < newVisibleCount; i++) {
                stillCuts[i].classList.remove("hide");
            }
            visibleCount = newVisibleCount; // ÏóÖÎç∞Ïù¥Ìä∏Îêú ÌëúÏãúÎêú Ìï≠Î™©Ïùò Ïàò

            // "Ï†ëÍ∏∞" Î≤ÑÌäºÏùÑ Ìï≠ÏÉÅ Î≥¥Ïó¨Ï§å
            document.getElementById("showLess").style.display = 'block';

            // Î™®Îì† Ìï≠Î™©Ïù¥ ÌëúÏãúÎêòÏóàÎäîÏßÄ ÌôïÏù∏
            if (visibleCount >= stillCuts.length) {
                // "ÎçîÎ≥¥Í∏∞"Î•º Ïà®ÍπÄ
                this.style.display = 'none';
            } else {
                // ÏïÑÏßÅ ÌëúÏãúÎêòÏßÄ ÏïäÏùÄ Ìï≠Î™©Ïù¥ ÏûàÎã§Î©¥ "ÎçîÎ≥¥Í∏∞"Î•º Í≥ÑÏÜç Î≥¥Ïó¨Ï§å
                this.style.display = 'block';
            }

        });

        document.getElementById("showLess").addEventListener("click", function () {
            var stillCuts = document.querySelectorAll(".still-cut");
            for (var i = 0; i < stillCuts.length; i++) {
                if (i > 5) { // Ï≤òÏùå 6Í∞úÎ•º Ï†úÏô∏Ìïú ÎÇòÎ®∏ÏßÄÎ•º Ïà®ÍπÅÎãàÎã§.
                    stillCuts[i].classList.add("hide");
                }
            }
            visibleCount = 4; // "Ï†ëÍ∏∞" ÌõÑ Ï≤òÏùå ÌëúÏãúÎêú Ìï≠Î™©Ïùò ÏàòÎ°ú Î¶¨ÏÖã
            this.style.display = 'none'; // "Ï†ëÍ∏∞"Î•º Ïà®ÍπÅÎãàÎã§.
            document.getElementById("showMore").style.display = 'block'; // "ÎçîÎ≥¥Í∏∞"Í∞Ä Îã§Ïãú Î≥¥Ïó¨Ïßà ÏÉÅÌô©ÏùÑ ÏúÑÌï¥
        });


        // Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠Ïãú ÏõêÎ≥∏ÌÅ¨Í∏∞Î°ú Î≥ºÏàòÏûàÍ≤å ÎùÑÏö∞Îäî Î™®Îã¨ Í¥ÄÎ†® Î≥ÄÏàò Î∞è Ìï®ÏàòÎì§
        var currentScrollPosition = 0;

        function openModal(imageSrc) {

            var header = document.getElementById("header")
            header.style.display = "hide"
            currentScrollPosition = window.scrollY;
            document.body.style.overflow = 'hide';
            var modal = document.getElementById("myModal");
            var modalImg = document.getElementById("modalImage");
            modal.style.display = "block";
            modalImg.src = imageSrc;
        }

        function closeModal() {
            var header = document.getElementById("header");
            header.style.display = '';
            var modal = document.getElementById("myModal");
            modal.style.display = "none";
            document.body.style.overflow = '';
            // ÏûêÍæ∏ Î™®Îã¨ Îã´ÏùÑÎïå Ìè¨Ïä§ÌÑ∞ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞Í∞Ä Î∞îÍª¥ÏÑú
            // Í±ç Î™®Îã¨ Ìï®ÏàòÏóêÏÑú Îã´ÏùÑÎïå Ìè¨Ïä§ÌÑ∞Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞Î•º Í∞ïÏ†úÎ°ú ÏÑ§Ï†ïÌï¥ÏÑú ÌÅ¨Í∏∞Î≥ÄÎèôÏù¥ ÏóÜÎäîÍ≤ÉÏ≤òÎüº Î≥¥Ïù¥Í≤åÌï®.
            document.querySelector('.image.featured img').style.width = '350px';
            document.querySelector('.image.featured img').style.height = '480px';

            window.scrollTo(0, currentScrollPosition);
        }

        /*--------- Ïù¥ÎØ∏ÏßÄ ÏÉÅÏÑ∏Î≥¥Í∏∞ Î™®Îã¨ ÎÅù --------*/

        /* Ïú†ÌäúÎ∏å Ìä∏Î†àÏùºÎü¨ Í¥ÄÎ†® Î™®Îã¨ ÏãúÏûë */

        // ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ÏóêÏÑú ÌÉÄÏûÑÎ¶¨ÌîÑÎ•º Ïù¥Ïö©Ìïú Î≥ÄÏàò Í∞ÄÏ†∏Ïò§Í∏∞ÏúÑÌïú ÏΩîÎìú Ìè¨Ìï®
        document.addEventListener('DOMContentLoaded', function () {
            var openModalButton = document.getElementById('videoModalBtn');
            if (openModalButton) {
                openModalButton.addEventListener('click', function () {
                    var modal = document.getElementById('videoModal');
                    var videoId = openModalButton.getAttribute('data-video-id');
                    var videoFrame = document.getElementById('videoFrame');

                    var preparingImage = videoFrame.parentNode.querySelector('img');
                    if (preparingImage) {
                        preparingImage.remove();
                    }

                    if (videoId == null) {
                        // ÎπÑÎîîÏò§ IDÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞, Ï§ÄÎπÑÏ§ë Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
                        videoFrame.style.display = 'none';
                        var preparingImage = document.createElement('img');
                        preparingImage.src = '/images/video_not_ready.jpg'; // Ï§ÄÎπÑÏ§ë Ïù¥ÎØ∏ÏßÄ URL
                        preparingImage.style.width = '100%';
                        preparingImage.style.height = '100%';
                        videoFrame.parentNode.appendChild(preparingImage);
                    } else {
                        // ÎπÑÎîîÏò§ IDÍ∞Ä ÏûàÎäî Í≤ΩÏö∞, ÎπÑÎîîÏò§ ÌëúÏãú
                        var videoUrl = 'https://www.youtube.com/embed/' + videoId;
                        videoFrame.src = videoUrl;
                        videoFrame.style.display = 'block';
                    }

                    modal.style.display = "flex"; // flexÎ°ú Î≥ÄÍ≤Ω
                    document.body.style.overflow = 'hide'; // Ïä§ÌÅ¨Î°§ ÎßâÍ∏∞
                });

                document.getElementsByClassName('close')[0].addEventListener('click', function () {
                    var modal = document.getElementById('videoModal');
                    modal.style.display = "none";
                    document.getElementById('videoFrame').src = ""; // ÎπÑÎîîÏò§ Ï§ëÏßÄ
                    document.body.style.overflow = ''; // Ïä§ÌÅ¨Î°§ Î≥µÏõê
                });
            }
        });

        /* Ïú†ÌäúÎ∏å Ìä∏Î†àÏùºÎü¨ Í¥ÄÎ†® Î™®Îã¨ ÎÅù */

        // Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Ïä§Ìã∏Ïª∑ ÎòêÎäî Î¶¨Î∑∞ ÌÖåÏù¥Î∏î
        document.addEventListener('DOMContentLoaded', function () {
            // document.querySelectorAll('img').forEach(function (img) {
            //     img.addEventListener('click', function () {
            //         this.style.width = (this.style.width === '100%') ? 'auto' : '100%';
            //     });
            // });

            var stillCutBtn = document.querySelector(".stillcut_btn");
            var reviewsBtn = document.querySelector(".reviews_btn");
            var stillCutDiv = document.getElementById("still-cut");
            var reviewsDiv = document.getElementById("reviews");

            stillCutBtn.addEventListener("click", function () {
                stillCutDiv.style.display = "block";
                reviewsDiv.style.display = "none";
                stillCutBtn.classList.add("clicked");
                reviewsBtn.classList.remove("clicked");
            });

            reviewsBtn.addEventListener("click", function () {
                stillCutDiv.style.display = "none";
                reviewsDiv.style.display = "block";
                reviewsBtn.classList.add("clicked");
                stillCutBtn.classList.remove("clicked");
            });
        });


        // Î¶¨Î∑∞ ÏûëÏÑ± Î™®Îã¨ÏùÑ ÌåùÏóÖ Ï∞ΩÏúºÎ°ú Ïó¥Í∏∞
        function openReviewModal() {
            // ÎåìÍ∏Ä ÏûëÏÑ± Ïó¨Î∂Ä ÌôïÏù∏
            $.ajax({
                url: `/movies/hasCommented/${movieId}`,
                method: 'GET',
                dataType: 'json',
                success: function (hasCommented, textStatus, xhr) {
                    console.log("hasCommented Í∞í:", hasCommented);

                    if (hasCommented) {
                        alert("Ïù¥ÎØ∏ ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±ÌïòÏÖ®ÏäµÎãàÎã§.");
                    } else {
                        var reviewWindow = window.open('/review/' + movieId, 'ReviewModal', 'width=600,height=400');
                        var checkWindowClosed = setInterval(function () {
                            if (reviewWindow.closed) {
                                clearInterval(checkWindowClosed);
                                loadComments();
                            }
                        }, 500); // 0.5Ï¥àÎßàÎã§ ÏÉÅÌÉú ÌôïÏù∏
                    }
                },
                error: function (xhr, status, error) {
                    if (xhr.status === 401) {
                        alert("Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
                    } else {
                        console.error("ÎåìÍ∏Ä ÏûëÏÑ± Ïó¨Î∂ÄÎ•º ÌôïÏù∏ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:", error);

                    }
                }
            });
        }

        //            ÎåìÍ∏ÄÎ¶¨Ïä§Ìä∏    --------------------------------------------------
        const loadComments = () => {

            const emojiMap = {
                1: 'üò°',
                2: 'üò†',
                3: 'üòê',
                4: 'üòä',
                5: 'üòç'
            };

            $.ajax({
                url: `/movies/` + movieId,
                method: 'GET',
                dataType: 'json',
                success: (data) => {
                    console.log(data)

                    let currentCommentIndex = 0;
                    const maxCommentDisplay = 3;
                    const remainingCommentCount = data.comments.length - currentCommentIndex;


                    //ÌèâÏ†ê
                    const movieDataSection = $('.movie_data_averageRating');
                    movieDataSection.text(`${data.averageRating !== null ? data.averageRating : 0}`);

                    const reviewsBtn = $('.reviews_btn');
                    reviewsBtn.text('Í¥ÄÎûåÌèâ (' + data.comments.length + ')');

                    //ÎåìÍ∏ÄÏ†ïÎ≥¥
                    const reviewsSection = $('#reviews-table');
                    reviewsSection.empty();
                    data.comments.forEach((comment, index) => {
                        if (index < maxCommentDisplay) {
                            appendReviewRow(reviewsSection, comment, emojiMap);
                        }
                    });

                    if (remainingCommentCount > 0) {
                        $('#showMore_review').show(); // "more" Î≤ÑÌäº ÌëúÏãú
                    } else {
                        $('#showMore_review').hide(); // "more" Î≤ÑÌäº Ïà®ÍπÄ
                    }

                    if (currentCommentIndex > 0) {
                        $('#showLess_review').show(); // "Ï†ëÍ∏∞" Î≤ÑÌäº ÌëúÏãú
                    } else {
                        $('#showLess_review').hide(); // "Ï†ëÍ∏∞" Î≤ÑÌäº Ïà®ÍπÄ
                    }

                    // "ÎçîÎ≥¥Í∏∞" Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
                    $('#showMore_review').click(() => {
                        currentCommentIndex += maxCommentDisplay;
                        reviewsSection.empty();
                        data.comments.forEach((comment, index) => {
                            if (index < currentCommentIndex + maxCommentDisplay) {
                                appendReviewRow(reviewsSection, comment, emojiMap);
                            }
                        });

                        $('#showMore_review').toggle(currentCommentIndex + maxCommentDisplay < data.comments.length);
                        $('#showLess_review').show();
                    });

                    // "Ï†ëÍ∏∞" Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
                    $('#showLess_review').click(() => {
                        currentCommentIndex = 0;
                        reviewsSection.empty();
                        data.comments.forEach((comment, index) => {
                            if (index < maxCommentDisplay) {
                                appendReviewRow(reviewsSection, comment, emojiMap);
                            }
                        });
                        $('#showMore_review').show();
                        $('#showLess_review').hide();
                    });
                },
                error: (xhr, status, error) => {
                    console.error("ÎåìÍ∏ÄÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§:", error);
                    $('#comments').append(`<div class="error"><p>ÎåìÍ∏ÄÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÎÇòÏ§ëÏóê Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</p></div>`);
                }
            });

        };

        loadComments();

        //Ïù¥Î©îÏùº Ï≤òÎ¶¨
        function maskEmail(email) {
            const atIndex = email.indexOf('@');
            let emailName = email.slice(0, atIndex);
            const emailDomain = email.slice(atIndex + 1);

            if (emailName.length > 3) {
                emailName = `${emailName.slice(0, -3)}***`;
            } else {
                emailName = '***';
            }

            return `${emailName}@${emailDomain}`;
        }

        function generateStars(grade) {
            return '‚òÖ'.repeat(grade);
        }

        //ÎåìÍ∏Ä ÏàòÎßåÌÅº Î∞òÎ≥µÏÉùÏÑ±
        function appendReviewRow(reviewsSection, comment, emojiMap) {
            const maskedEmail = maskEmail(comment.memberEmail);
            const stars = generateStars(comment.grade);
            const emoji = emojiMap[comment.grade] || '';
            const isOwner = userEmail === comment.memberEmail;
            // const adming =
            const reviewRow = `

        <tr>
            <td>
                <div class="review">
                    <h4 class="review-user-email">${maskedEmail}</h4>
                    <span class="review-emoji">${emoji}</span>
                    <input class="review-stars" type="radio" id="${comment.grade}-stars" value="${comment.grade}" checked="checked" />
                    <span class="review-comment" style="margin-left: 40px">${comment.comment}</span>
                    <div class="review-right">
                        <span class="review-date">${new Date().toISOString().slice(0, 10)}</span>
                          ${isOwner ? `<button class="delete-btn" data-comment-id="${comment.cno}" style="margin-left: 20px;">ÏÇ≠Ï†ú</button>` : ''}
                    </div>
                </div>
            </td>
        </tr>
    `;
            reviewsSection.append(reviewRow);
        }

        // Ï∞úÌïòÍ∏∞ Í¥ÄÎ†® Ìï®Ïàò ÏãúÏûë //


        $(document).ready(function () {

            var isFavorited = false; // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò Ï∞úÌïòÍ∏∞(Ï¢ãÏïÑÏöî) ÏÉÅÌÉúÎ•º Ï†ÄÏû•Ìï† Î≥ÄÏàòÏûÑ

            // ÌòÑÏû¨ Ï∞úÌïòÍ∏∞ ÏÉÅÌÉúÎ•º Í∞ÄÏ†∏Ïò§Í∏∞ ÏúÑÌï¥ API Ìò∏Ï∂ú
            $.ajax({
                url: '/favorites/check/' + userEmail + '/' + movieId,
                type: 'GET',
                data: {
                    userEmail: userEmail,
                    movieId: movieId
                },
                success: function (response) {
                    // ÏùëÎãµÏóêÏÑú ÌòÑÏû¨ Î¶¨Ïï°ÏÖò ÏÉÅÌÉúÎ•º Î∞õÏïÑÏôÄ Î≤ÑÌäº ÏÉÅÌÉúÎ•º ÏóÖÎç∞Ïù¥Ìä∏
                    isFavorited = response.isFavorited;
                    console.log("ÌòÑÏû¨ Î¶¨Ïï°ÏÖò ÏÉÅÌÉú Í∞ÄÏ†∏Ïò§Í∏∞ ÏÑ±Í≥µ! ÌòÑÏû¨ÏÉÅÌÉú = " + isFavorited)
                    updateFavoriteButton(isFavorited)
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching current reaction:', status, error);
                }
            });


            $("#favoriteButton").click(function () {

                checkAnonymousUser();

                if (isFavorited === false) {
                    // Ï¢ãÏïÑÏöî ÏöîÏ≤≠ (POST ÏöîÏ≤≠)
                    $.ajax({
                        url: '/favorites/' + userEmail + '/' + movieId,
                        type: 'POST',
                        success: function (response) {
                            console.log("Ï¢ãÏïÑÏöî Îì±Î°ùÏÑ±Í≥µ")
                            isFavorited = true;
                            updateFavoriteButton(isFavorited)
                        },
                        error: function (xhr, status, error) {
                            console.error("Ï¢ãÏïÑÏöî Îì±Î°ù Ïã§Ìå®", error)
                        }
                    });
                } else {
                    // Ï¢ãÏïÑÏöî ÏÇ≠Ï†úÏöîÏ≤≠ (DELETE ÏöîÏ≤≠)
                    $.ajax({
                        url: '/favorites/' + userEmail + '/' + movieId,
                        type: 'DELETE',
                        success: function (response) {
                            console.log("Ï¢ãÏïÑÏöî ÏÇ≠Ï†ú ÏÑ±Í≥µ")
                            isFavorited = false;
                            updateFavoriteButton(isFavorited)
                        },
                        error: function (xhr, status, error) {
                            console.error("Ï¢ãÏïÑÏöî Îì±Î°ù Ïã§Ìå®", error)
                        }
                    });
                }
            });

            // Î≤ÑÌäºÏÉÅÌÉú Ìï®Ïàò (ÏûÑÏãú!!!)
            function updateFavoriteButton(isFavorited) {
                var favoriteButton = $('#favoriteButton');
                if (isFavorited) {
                    favoriteButton.addClass('favorited'); // Ï∞úÌïú ÏÉÅÌÉú ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                } else {
                    favoriteButton.removeClass('favorited'); // Ï∞úÌïú ÏÉÅÌÉú ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                }
            }
        });


        /* Ï¢ãÏïÑÏöî Ïã´Ïñ¥Ïöî Ïä¨ÌçºÏöî Îì±Îì± Î¶¨Ïï°ÏÖò Í¥ÄÎ†® Ìï®Ïàò ÏãúÏûë */

        var currentReactions = {}; // ÏÇ¨Ïö©ÏûêÏùò ÌòÑÏû¨ Î¶¨Ïï°ÏÖò ÏÑ†ÌÉùÏùÑ Ï∂îÏ†ÅÌïòÎäî Í∞ùÏ≤¥

        var userEmail = [[${userEmail}]];

        var isRequestPending = false; // ÎπÑÎèôÍ∏∞ ÏöîÏ≤≠ ÏÉÅÌÉúÎ•º Ï∂îÏ†ÅÌïòÎäî ÌîåÎûòÍ∑∏

        var userCurrentReaction = null; // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò Î¶¨Ïï°ÏÖò ÏÉÅÌÉúÎ•º Ï†ÄÏû•Ìï† Î≥ÄÏàò

        // ÎπÑÌöåÏõê Ï≤¥ÌÅ¨
        function checkAnonymousUser() {
            if (!userEmail || userEmail === 'anonymousUser') {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return true;
            }
            return false;
        }

        async function addReaction(userEmail, movieId, reactionType) {

            if (isRequestPending) {
                return; // ÎπÑÎèôÍ∏∞ ÏöîÏ≤≠ Ï§ëÏù¥Î©¥ ÌÅ¥Î¶≠ÏùÑ Î¨¥Ïãú
            }
            isRequestPending = true; // ÎπÑÎèôÍ∏∞ ÏöîÏ≤≠ ÏãúÏûë

            try {
                if (!(movieId in currentReactions)) {
                    currentReactions[movieId] = {};
                }
                var currentMemberReaction = currentReactions[movieId][userEmail];

                if (currentMemberReaction === reactionType) {
                    await removeReaction(userEmail, movieId, reactionType);
                    delete currentReactions[movieId][userEmail];
                } else {
                    if (currentMemberReaction) {
                        await removeReaction(userEmail, movieId, currentMemberReaction);
                    }
                    await sendReaction(userEmail, movieId, reactionType);
                    currentReactions[movieId][userEmail] = reactionType;
                }
            } catch (error) {
                console.error('Error processing reaction:', error);
            } finally {
                isRequestPending = false;
            }
        }

        function sendReaction(userEmail, movieId, reactionType) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: '/add',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        userEmail: userEmail,
                        movieId: movieId,
                        reactionType: reactionType
                    }),
                    success: function (response) {
                        console.log('Response:', response);
                        updateReactionCount(movieId);
                        resolve(response);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error adding reaction:', status, error);
                        reject(error);
                    }
                });
            });
        }

        function updateReactionCount(movieId) {
            $.ajax({
                url: '/movie/' + movieId,
                type: 'GET',
                success: function (response) {
                    $('#likeCount_' + movieId).text(response.likeCount);
                    $('#dislikeCount_' + movieId).text(response.dislikeCount);
                    $('#sadCount_' + movieId).text(response.sadCount);
                    $('#funnyCount_' + movieId).text(response.funnyCount);
                    $('#scaryCount_' + movieId).text(response.scaryCount);
                },
                error: function (xhr, status, error) {
                    console.error("Error updating reaction count", error);
                }
            });
        }

        // Î¶¨Ïï°ÏÖò ÏÇ≠Ï†ú
        function removeReaction(userEmail, movieId, reactionType) {
            var data = {
                userEmail: userEmail,
                movieId: movieId,
                reactionType: reactionType
            };

            // movieId(ÏòÅÌôîÏãùÎ≥ÑÏ†ïÎ≥¥)Í∞Ä ÏóÜÍ±∞ÎÇò userEmail(ÌöåÏõêÏ†ïÎ≥¥,Î°úÍ∑∏Ïù∏Ï†ïÎ≥¥)Í∞Ä ÏóÜÏúºÎ©¥ return
            // Î≤ÑÌäºÏó∞ÌÉÄÏãú ajax ÏöîÏ≤≠ Íº¨Ïù¥ÎäîÍ±∞ Î∞©ÏßÄÌï†Î†§Í≥† Ï∂îÍ∞ÄÌï®
            if (!userEmail || !movieId) {
                console.error('Error removing reaction: userEmail or movieId is missing');
                return;
            }

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: '/remove',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (response) {
                        console.log('Response:', response);
                        updateReactionCount(movieId);
                        if (currentReactions[movieId]) {
                            delete currentReactions[movieId][userEmail];
                            if (Object.keys(currentReactions[movieId]).length === 0) {
                                delete currentReactions[movieId];
                            }
                        }
                        resolve(response);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error removing reaction:', status, error);
                        console.log('XHR Object:', xhr);
                        console.log('Response Text:', xhr.responseText);
                        reject(error);
                    }
                });
            });
        }

        // ÏÇ¨Ïö©ÏûêÏùò ÌòÑÏû¨ Î¶¨Ïï°ÏÖò ÏÉÅÌÉúÎ•º Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Î∞îÎ°ú Î∞úÎèôÎêòÍ≤å Ìï¥ÎÜìÏùå
        // ÌòÑÏû¨ Î¶¨Ïï°ÏÖòÏÉÅÌÉúÎ•º Í∞ÄÏ†∏ÏôÄÏÑú ÏÉàÎ°úÍ≥†Ïπ®ÌïòÎ©¥ Ï§ëÎ≥µÏúºÎ°ú ÎàÑÎ•ºÏàòÏûàÎçòÎ∂ÄÎ∂Ñ Ìï¥Í≤∞
        function initializeReactions() {
            // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏôÄ ÏòÅÌôî IDÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§. Ïù¥ Î∂ÄÎ∂ÑÏùÄ ÏÇ¨Ïö©ÏûêÏóê ÎßûÍ≤å Î≥ÄÍ≤ΩÌï¥Ïïº Ìï©ÎãàÎã§.
            // ÌòÑÏû¨ Î¶¨Ïï°ÏÖò ÏÉÅÌÉúÎ•º Í∞ÄÏ†∏Ïò§Í∏∞ ÏúÑÌï¥ API Ìò∏Ï∂ú
            $.ajax({
                url: '/getCurrentReaction',
                type: 'GET',
                data: {
                    userEmail: userEmail,
                    movieId: movieId
                },
                success: function (response) {
                    // ÏùëÎãµÏóêÏÑú ÌòÑÏû¨ Î¶¨Ïï°ÏÖò ÏÉÅÌÉúÎ•º Î∞õÏïÑÏôÄ Î≤ÑÌäº ÏÉÅÌÉúÎ•º ÏóÖÎç∞Ïù¥Ìä∏
                    userCurrentReaction = response.reactionType;
                    updateButtonState()
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching current reaction:', status, error);
                }
            });
        }

        // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò Ï∂îÍ∞Ä
        function updateButtonState() { // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Ìï®Ïàò
            // Î™®Îì† Î≤ÑÌäºÏóêÏÑú active ÌÅ¥ÎûòÏä§Î•º Ï†úÍ±∞
            $('#likeButton, #dislikeButton, #sadButton, #funnyButton, #scaryButton').removeClass('active');

            // ÌòÑÏû¨ Î¶¨Ïï°ÏÖòÏóê Ìï¥ÎãπÌïòÎäî Î≤ÑÌäºÏóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            // active ÌÅ¥ÎûòÏä§ ÌôúÏö©Ìï¥ÏÑú ÏÑ†ÌÉùÌïúÎ≤ÑÌäºÏóêÎßå cssÎ•º Ï∂îÍ∞ÄÌï¥ Íæ∏Î∞ÄÏàòÏûàÏùå
            if (userCurrentReaction === 'LIKE') {
                $('#likeButton').addClass('active');
            } else if (userCurrentReaction === 'DISLIKE') {
                $('#dislikeButton').addClass('active');
            } else if (userCurrentReaction === 'SAD') {
                $('#sadButton').addClass('active');
            } else if (userCurrentReaction === 'FUNNY') {
                $('#funnyButton').addClass('active');
            } else if (userCurrentReaction === 'SCARY') {
                $('#scaryButton').addClass('active');
            }
        }

        function react(reactionType) {

            // ÎπÑÌöåÏõê Ï≤¥ÌÅ¨
            if (checkAnonymousUser()) {
                return;
            }
            // Ïù¥Ï†ÑÏóê ÏÑ†ÌÉùÌïú Î¶¨Ïï°ÏÖòÏùÑ ÏÑúÎ≤ÑÏóêÏÑú ÏÇ≠Ï†ú
            if (userCurrentReaction === reactionType) {
                removeReaction(userEmail, movieId, reactionType)
                userCurrentReaction = null;// Ïù¥Ï†Ñ Î¶¨Ïï°ÏÖò ÏÉÅÌÉúÎ•º Ï¥àÍ∏∞Ìôî
                updateButtonState()
                return;
            } else if (userCurrentReaction) {
                removeReaction(userEmail, movieId, reactionType);
                updateButtonState()
            }
            // ÏÉàÎ°úÏö¥ Î¶¨Ïï°ÏÖòÏùÑ Ï∂îÍ∞ÄÌïòÍ≥† ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏°Ïùò Î¶¨Ïï°ÏÖò ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            addReaction(userEmail, movieId, reactionType)
            userCurrentReaction = reactionType; // ÏÉàÎ°úÏö¥ Î¶¨Ïï°ÏÖò ÏÉÅÌÉú ÏÑ§Ï†ï
            updateButtonState()
        }

        function updateMetaDescription() {
            var detailElement = document.querySelector('.movie_detail');
            if (detailElement) {
                var detailText = detailElement.innerText;
                var metaDescription = document.getElementById('og-description');
                if (metaDescription) {
                    metaDescription.setAttribute('content', detailText);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {

            updateMetaDescription();
            // Kakao SDK Ï¥àÍ∏∞Ìôî
            Kakao.init('3d074cbbda365535b831c90baead22c2'); // Ïó¨Í∏∞Ïóê Ïã§Ï†ú Kakao Ïï± ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.

            console.log("movieId = " + movieId);

            var likeCountSpans = document.querySelectorAll('.like-count');
            var dislikeCountSpans = document.querySelectorAll('.dislike-count');
            var sadCountSpans = document.querySelectorAll('.sad-count');
            var funnyCountSpans = document.querySelectorAll('.funny-count');
            var scaryCountSpans = document.querySelectorAll('.scary-count');

            likeCountSpans.forEach(span => {
                span.id = 'likeCount_' + movieId;
            });
            dislikeCountSpans.forEach(span => {
                span.id = 'dislikeCount_' + movieId;
            });
            sadCountSpans.forEach(span => {
                span.id = 'sadCount_' + movieId;
            });
            funnyCountSpans.forEach(span => {
                span.id = 'funnyCount_' + movieId;
            });
            scaryCountSpans.forEach(span => {
                span.id = 'scaryCount_' + movieId;
            });
            updateReactionCount(movieId);
            initializeReactions();
        });

        $(document).on('click', '.delete-btn', function () {
            const cno = $(this).data('comment-id');
            console.log(cno);
            deleteComment(cno);
        });

        function deleteComment(cno) {
            $.ajax({
                url: `/movies/delete/${cno}`,
                method: 'DELETE',
                success: function (response) {
                    alert("ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
                    loadComments(); // ÎåìÍ∏Ä Î™©Î°ù Îã§Ïãú Î°úÎìú
                },
                error: function (xhr, status, error) {
                    console.error("ÎåìÍ∏Ä ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:", error);
                    alert("ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÎÇòÏ§ëÏóê Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
                }
            });
        }

        // Kakao Í≥µÏú† Ìï®Ïàò
        function shareMessage() {
            var currentUrl = window.location.href;
            var urlSegments = currentUrl.split('/');
            var movieId = urlSegments[urlSegments.length - 1];

            var titleElement = document.querySelector('.movie_title');
            var detailElement = document.querySelector('.movie_detail');
            var imageElement = document.querySelector('.featured img');

            if (titleElement && detailElement && imageElement) {
                var title = titleElement.innerText;
                var detail = detailElement.innerText;
                var imageUrl = imageElement.src;

                Kakao.Link.sendDefault({
                    objectType: 'feed',
                    content: {
                        title: title, // Ïù¥Î≤§Ìä∏ Ï†úÎ™©
                        description: detail, // Ïù¥Î≤§Ìä∏ ÏÉÅÏÑ∏ ÎÇ¥Ïö©
                        imageUrl: imageUrl, // Ïù¥Î≤§Ìä∏ Ïù¥ÎØ∏ÏßÄ URL
                        link: {
                            mobileWebUrl: `http://localhost:8080/movies/${movieId}`, // ÎèôÏ†Å Ïù¥Î≤§Ìä∏ IDÎ•º Ìè¨Ìï®Ìïú URL
                            webUrl: `http://localhost:8080/movies/${movieId}`
                        }
                    }
                });
            } else {
                console.error('ÌïÑÏöîÌïú ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
        }


        // ÏßÅÏ†ë Îì±Î°ùÌïú ÏòÅÌôî Î∞∞Ïö∞Î™©Î°ù ÌôîÎ©¥Ïóê ÎùÑÏö∞Í∏∞
        document.addEventListener("DOMContentLoaded", function() {

            // movieIdÍ∞Ä 10ÏûêÎ¶¨Ïù∏ Í≤ΩÏö∞ÏóêÎßå Ïã§ÌñâÎêòÎäî ÏΩîÎìú
            if (movieId.length === 10) {
                // Î¨¥ÎπÑ IDÎ•º Í∏∞Î∞òÏúºÎ°ú ÏÑúÎ≤ÑÏóê ÏöîÏ≤≠ÌïòÏó¨ Ìï¥Îãπ Î¨¥ÎπÑÏóê Ï∂úÏó∞Ìïú Î∞∞Ïö∞Îì§Ïùò ID Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò¥
                fetch(`/actors/${movieId}`)
                    .then(response => response.json())
                    .then(actorIds => {
                        // Í∞Å Î∞∞Ïö∞Ïùò IDÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ï∂îÍ∞ÄÏ†ÅÏù∏ Îç∞Ïù¥ÌÑ∞Î•º ÏöîÏ≤≠ÌïòÍ≥† Ï≤òÎ¶¨
                        actorIds.forEach(actorId => {
                            fetch(`/actor/${actorId}`)
                                .then(response => response.json())
                                .then(actorData => {
                                    // actorDataÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÌïÑÏöîÌïú ÏûëÏóÖ ÏàòÌñâ
                                    console.log(actorData + " === actorData Ï≤¥ÌÅ¨");
                                    // Í∞Å Î∞∞Ïö∞ Ï†ïÎ≥¥Î•º ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä (Í∞ÄÎ°úÎ°ú ÎÇòÏó¥)
                                    const castMembersDiv = document.getElementById('cast-members');
                                    castMembersDiv.style.display = 'flex'; // Flexbox Î†àÏù¥ÏïÑÏõÉ Ï†ÅÏö©
                                    castMembersDiv.style.flexWrap = 'wrap'; // ÏöîÏÜåÎì§Ïù¥ ÎÑòÏπòÎ©¥ Îã§Ïùå Ï§ÑÎ°ú ÎÑòÍπÄ
                                    const actorDiv = createPersonDiv(actorData.actorName, actorData.actorProfilePic);
                                    castMembersDiv.appendChild(actorDiv);
                                })
                                .catch(error => {
                                    console.error('Error fetching actor data:', error);
                                });
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching actor IDs:', error);
                    });
            }

            // Ïù∏Î¨º Ï†ïÎ≥¥ÏôÄ Ïù¥ÎØ∏ÏßÄÎ•º Îã¥ÏùÄ div ÏÉùÏÑ± Ìï®Ïàò
            function createPersonDiv(name, profilePath) {
                const personDiv = document.createElement('div'); // ÏÉàÎ°úÏö¥ div ÏÉùÏÑ±
                personDiv.style.margin = '13px'; // Í∞ÑÍ≤© ÏÑ§Ï†ï
                personDiv.style.width = '7em';
                personDiv.style.height = 'auto';
                personDiv.style.borderRadius = '10px';

                const p = document.createElement('p');
                p.innerHTML = `<p>${name}</p>`;
                p.style.fontSize = '0.8em'; // Í∏ÄÏûê ÌÅ¨Í∏∞ ÏûëÍ≤å ÏÑ§Ï†ï
                p.style.textAlign = 'center';

                const img = document.createElement('img');
                img.src = profilePath ? `https://image.tmdb.org/t/p/w200${profilePath}` : '/images/img_not_ready2.png';
                img.alt = `${name}'s profile image`;
                img.setAttribute('style', 'width: 100%; height: auto; border-radius: 10px;');

                personDiv.appendChild(img);
                personDiv.appendChild(p);

                return personDiv;
            }
        });
        //Î©îÏÑ∏ÏßÄÏïåÎûå ÎàÑÎ•¥Î©¥ Ï±ÑÌåÖÎ∞©Ïù¥Îèô
        function redirectToChatRoom() {
            window.location.href = '/chatUser';
        }

    </script>
</th:block>
</body>
</html>