<nav class="layout-navbar navbar navbar-expand-xl align-items-center bg-navbar-theme" id="layout-navbar" style="margin-bottom: 10px;">
    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
        <!-- Search -->
        <div class="navbar-nav align-items-center">
            <div class="nav-item d-flex align-items-center">
                <i class="bx bx-search fs-4 lh-0"></i>
                <h4>상영관 좌석 배치하기</h4>
            </div>
        </div>
        <!-- /Search -->
    </div>
</nav>
<!-- / Navbar -->

<!-- Basic Layout -->
<div class="row">
    <div class="col-xl">
        <div class="card mb-4">
            <div class="card-body schedule_reg">
                <form id="theater-form" method="post" th:action="@{/admin/seatRegister}" th:object="${seatForm}">
                    <div class="mb-3">
                        <div class="input-group">
                            <label class="input-group-text label-text" for="region-select">지역 선택</label>
                            <select class="form-select" id="region-select" th:field="*{region}">
                                <option value="">지역을 선택해주세요.</option>
                                <option value="Seo" th:selected="${seatForm.region == 'Seo'}" th:text="'서울'"></option>
                                <option value="Inc" th:selected="${seatForm.region == 'Inc'}" th:text="'인천 / 경기'"></option>
                                <option value="Gan" th:selected="${seatForm.region == 'Gan'}" th:text="'강원'"></option>
                                <option value="Chu" th:selected="${seatForm.region == 'Chu'}" th:text="'대전 / 충청'"></option>
                                <option value="Dae" th:selected="${seatForm.region == 'Dae'}" th:text="'대구 / 경북'"></option>
                                <option value="Bus" th:selected="${seatForm.region == 'Bus'}" th:text="'부산 / 울산 / 경남'"></option>
                                <option value="Gwa" th:selected="${seatForm.region == 'Gwa'}" th:text="'광주 / 전라'"></option>
                                <option value="Jeju" th:selected="${seatForm.region == 'Jeju'}" th:text="'제주'"></option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="input-group">
                            <label class="input-group-text label-text" for="theater-names-select">지점명 선택</label>
                            <select class="form-select" id="theater-names-select" th:field="*{theaterName}">
                                <option value="">극장을 선택해주세요.</option>
                                <option th:value="${seatForm.theaterName}" th:selected="${seatForm.theaterName}" th:text="${seatForm.theaterName}"></option>

                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="input-group">
                            <label class="input-group-text label-text" for="theater-numbers">상영관 번호 선택</label>
                            <select class="form-select" id="theater-numbers">
                                <option selected>상영관을 선택해주세요.</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 theater-seat-cnt">
                        <label class="form-label" for="seats-count">총 보유한 좌석 수</label>
                        <input type="number" id="seats-count" readonly class="form-control-plaintext" />
                    </div>
                    <div class="mb-3 row">
                        <div class="mt-2 mb-3 col-sm-3">
                            <label for="A" class="form-label">A열</label>
                            <input
                                    id="A"
                                    class="form-control form-control-lg"
                                    type="number"
                                    placeholder="A열 좌석 수를 입력하세요."
                            />
                        </div>
                        <div class="mt-2 mb-3 col-sm-3">
                            <label for="B" class="form-label">B열</label>
                            <input
                                    id="B"
                                    class="form-control form-control-lg"
                                    type="number"
                                    placeholder="B열 좌석 수를 입력하세요."
                            />
                        </div>
                        <div class="mt-2 mb-3 col-sm-3">
                            <label for="C" class="form-label">C열</label>
                            <input
                                    id="C"
                                    class="form-control form-control-lg"
                                    type="number"
                                    placeholder="C열 좌석 수를 입력하세요."
                            />
                        </div>
                        <div class="mt-2 mb-3 col-sm-3">
                            <label for="D" class="form-label">D열</label>
                            <input
                                    id="D"
                                    class="form-control form-control-lg"
                                    type="number"
                                    placeholder="D열 좌석 수를 입력하세요."
                            />
                        </div>
                        <div class="mt-2 mb-3 col-sm-3">
                            <label for="E" class="form-label">E열</label>
                            <input
                                    id="E"
                                    class="form-control form-control-lg"
                                    type="number"
                                    placeholder="E열 좌석 수를 입력하세요."
                            />
                        </div>
                        <div class="mt-2 mb-3 col-sm-3">
                            <label for="F" class="form-label">F열</label>
                            <input
                                    id="F"
                                    class="form-control form-control-lg"
                                    type="number"
                                    placeholder="F열 좌석 수를 입력하세요."
                            />
                        </div>
                        <div class="mt-2 mb-3 col-sm-3 d-flex align-items-end add-column">
                            <button type="button" class="btn btn-gray add-column-btn">+</button>
                        </div>
                    </div>
                    <button class="btn btn-gray" type="button">좌석 배치도 결과보기</button>
                    <button class="btn btn-primary" type="submit">등록하기</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (Optional) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


<script>
    $(document).ready(function () {
        const regionValue = "<%= region %>";
        let theaterNameValue = "<%= theaterName %>";

        $('#region-select').val(regionValue);
        $('#theater-names-select').val(theaterNameValue);

        let columnCount = 1;
        const alphabet = 'FGHIJKLMN';
        $('.add-column-btn').on('click', function (e) {
            e.preventDefault();
            if (columnCount < alphabet.length) {
                const letter = alphabet[columnCount];
                columnCount++;
                const newColumn = `
                <div class="mt-2 mb-3 col-sm-3">
                    <label for="${letter}" class="form-label">${letter}열</label>
                    <input id="${letter}" class="form-control form-control-lg" type="number" placeholder="${letter}열 좌석 수를 입력하세요." />
                </div>
            `;
                $(newColumn).insertBefore('.add-column:first');
            } else {
                $(this).hide();
                Swal.fire({
                    title: '',
                    text: '더 이상 열 추가할 수 없습니다.',
                    icon: 'error',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '확인',
                    cancelButtonText: '취소',
                    reverseButtons: true,
                });
            }
        });

        $('#region-select').change(function(event) {
            event.preventDefault();
            const selectedValue = $(this).val();
            $.ajax({
                type: "GET",
                url: "/reservation/getTheatersByRegion",
                data: {
                    region: selectedValue
                },
                success: function(data) {
                    const theaterNamesSelect = $("#theater-names-select");
                    theaterNamesSelect.empty();

                    theaterNamesSelect.append($("<option selected>지역을 선택해주세요.</option>"));
                    if(data.length > 0) {
                        $.each(data, function(index, theater) {
                            const $option = $("<option></option>").val(theater.theaterName).text(theater.theaterName);
                            theaterNamesSelect.append($option);
                        });
                    } else {
                        const $option = $("<option></option>").val("").text("해당 지역에 영화관이 없습니다.");
                        theaterNamesSelect.append($option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX 요청 실패:", error); // 오류 메시지 출력
                }
            });
        });
    });
</script>