<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns="http://www.w3.org/1999/html"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Cinemacast</title>
    <!-- SweetAlert2 기본 스타일 추가 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        /* SweetAlert2 스타일 덮어쓰기 */
        .swal2-popup {
            font-size: 1.2rem; /* 예: 글꼴 크기를 변경 */
            color: #333; /* 텍스트 색상 */
            background: #fff; /* 배경 색상 */
            border: 1px solid #ddd; /* 테두리 */
            border-radius: 8px; /* 모서리 둥글기 */
        }
        .swal2-title {
            font-size: 1.5em; /* 제목 크기 */
            font-weight: bold; /* 제목 굵기 */
        }
        .swal2-content {
            font-size: 1em; /* 본문 크기 */
        }
        .swal2-confirm {
            background-color: #3085d6; /* 확인 버튼 배경 색상 */
            color: #fff; /* 확인 버튼 텍스트 색상 */
            border: none; /* 확인 버튼 테두리 */
        }
        .swal2-cancel {
            background-color: #aaa; /* 취소 버튼 배경 색상 */
            color: #fff; /* 취소 버튼 텍스트 색상 */
            border: none; /* 취소 버튼 테두리 */
        }
    </style>
</head>
<body class="left-sidebar is-preload">
<div id="page-wrapper">

    <!-- header -->
    <th:block th:replace="fragment/header::header"></th:block>

    <!-- Main -->
    <div class="wrapper style1">
        <div class="container">
            <div class="row gtr-200">
                <div class="col-4 col-12-mobile" id="sidebar">
                    <section>
                        <header>
                            <h2 class="main_btn" style="cursor: pointer">My Page</h2>
                        </header>
                        <div class="mypage_nav">
                            <nav>
                                <ul>
                                    <li>
                                        <a>예매관리</a>
                                        <ul>
                                            <li>
                                                <a class="reservation_btn">예매내역 조회</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a>주문관리</a>
                                        <ul>
                                            <li><a class="order_btn">주문내역 조회</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a>회원 혜택 및 활동</a>
                                        <ul>
                                            <li>
                                                <a class="membership_btn">회원등급안내</a>
                                            </li>
                                            <li>
                                                <a class="point_btn">포인트 현황</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a>리뷰관리</a>
                                        <ul>
                                            <li><a class="review_btn">나의 리뷰</a></li>
                                            <li><a class="favorite_btn">나의 찜목록</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a class="member_info_btn">회원정보</a>
                                        <ul>
                                            <li>
                                                <a class="info_edit_btn">개인정보수정</a>
                                            </li>
                                            <li th:if="${formUser == 'formUser'}">
                                                <a class="password_edit_btn">비밀번호수정</a>
                                            </li>
                                            <li>
                                                <a class="cancel_btn">회원탈퇴</a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </section>
                </div>
                <div class="col-8 col-12-mobile imp-mobile" id="content">
                    <!-- This is where the loaded content will appear -->
                </div>
            </div>
            <!-- content -->
        </div>
    </div>
    <!-- footer -->
    <th:block th:replace="fragment/footer::footer"></th:block>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script th:inline="javascript">
    const memberId = [[${memberId}]];

    $(document).ready(function() {
        // 마이페이지 메인
        $('#sidebar').on('click', '.main_btn', function() {
            $('#content').load('/mypage/main');
        });
        // 예매내역 조회 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.reservation_btn', function() {
            $('#content').load('/mypage/reservation');
        });
        // 주문내역조회 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.order_btn', function() {
            $('#content').load('/mypage/order');
        });
        // 회원등급안내 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.membership_btn', function() {
            $('#content').load('/mypage/membership');
        });
        // 포인트 현황 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.point_btn', function() {
            $('#content').load('/mypage/point');
        });
        // 나의리뷰 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.review_btn', function() {
            $('#content').load('/mypage/review');
        });
        // 나의찜목록 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.favorite_btn', function() {
            $('#content').load('/mypage/favorite');
        });
        // 개인정보수정 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.info_edit_btn', function() {
            $('#content').load('/mypage/infoEdit');
        });
        // 비밀번호수정 버튼 클릭 이벤트
        $('#sidebar').on('click', '.password_edit_btn', function() {
            $('#content').load('/mypage/passwordEdit');
        });
        // 회원탈퇴 버튼 클릭 이벤트 설정
        $('#sidebar').on('click', '.cancel_btn', function() {
            Swal.fire({
                title: "정말로 탈퇴하시겠습니까?",
                text: "기존의 정보는 모두 복구불가합니다.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "네, 탈퇴하겠습니다."
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: 'POST',
                        url: '/mypage/memberDelete',
                        data: {
                            memberId: memberId
                        },
                        success: function() {
                            // 회원탈퇴 처리 성공
                            sessionStorage.removeItem("userInfo"); // session storage값 삭제
                            window.location.href = "/";
                        },
                        error: function(xhr, status, error) {
                            // 에러 처리 코드
                            console.error("회원탈퇴 요청 중 에러 발생:", error);
                        }
                    });
                }
            });
        });

        // 페이지 로드 시 .main_btn 클릭 트리거
        $('.main_btn').trigger('click');
    });
</script>
</body>
</html>
